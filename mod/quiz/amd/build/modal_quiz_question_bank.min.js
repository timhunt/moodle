define("mod_quiz/modal_quiz_question_bank",["exports","jquery","./add_question_modal","core/fragment","core_form/changechecker","core/modal_events"],(function(_exports,_jquery,_add_question_modal,Fragment,FormChangeChecker,ModalEvents){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_add_question_modal=_interopRequireDefault(_add_question_modal),Fragment=_interopRequireWildcard(Fragment),FormChangeChecker=_interopRequireWildcard(FormChangeChecker),ModalEvents=_interopRequireWildcard(ModalEvents);const SELECTORS_ADD_TO_QUIZ_CONTAINER="td.addtoquizaction",SELECTORS_ANCHOR="a[href]",SELECTORS_PREVIEW_CONTAINER="td.previewquestionaction",SELECTORS_ADD_QUESTIONS_FORM="form#questionsubmit",SELECTORS_SORTERS=".sorters",SELECTORS_SWITCH_TO_OTHER_BANK='button[data-action="switch-question-bank"]',SELECTORS_NEW_BANKMOD_ID="data-newmodid",SELECTORS_BANK_SEARCH="#searchbanks";class ModalQuizQuestionBank extends _add_question_modal.default{static init(contextId,bankModId,quizModId,courseOpenBanks,allOpenBanks,recentlyViewedBanks){document.addEventListener("click",(e=>{const trigger=e.target.closest('.menu [data-action="questionbank"]');trigger&&(e.preventDefault(),ModalQuizQuestionBank.create({contextId:contextId,quizModId:quizModId,bankModId:bankModId,courseOpenBanks:courseOpenBanks,allOpenBanks:allOpenBanks,recentlyViewedBanks:recentlyViewedBanks,title:trigger.dataset.header,addOnPage:trigger.dataset.addonpage,templateContext:{hidden:!0},large:!0}))}))}show(){return this.reloadBodyContent(window.location.search),super.show(this)}reloadBodyContent(querystring){this.setBody(Fragment.loadFragment("mod_quiz","quiz_question_bank",this.getContextId(),{querystring:querystring,quizmodid:this.getQuizModId(),bankmodid:this.getBankModId()}))}handleAddToQuizEvent(e,anchorElement){const href=new URL(anchorElement.attr("href"));href.searchParams.set("addonpage",this.getAddOnPageId()),href.searchParams.set("cmid",this.getQuizModId()),anchorElement.attr("href",href)}registerEventListeners(){super.registerEventListeners(this),this.getModal().on("submit",SELECTORS_ADD_QUESTIONS_FORM,(e=>{const formElement=(0,_jquery.default)(e.currentTarget);(0,_jquery.default)("<input />").attr("type","hidden").attr("name","addonpage").attr("value",this.getAddOnPageId()).appendTo(formElement),(0,_jquery.default)("<input />").attr("type","hidden").attr("name","cmid").attr("value",this.getQuizModId()).appendTo(formElement);const actionUrl=new URL(formElement.attr("action"));actionUrl.searchParams.set("cmid",this.getQuizModId()),formElement.attr("action",actionUrl.toString())})),this.getModal().on("click",SELECTORS_SWITCH_TO_OTHER_BANK,(()=>{this.handleSwitchBankContentReload(SELECTORS_BANK_SEARCH).then((function(ModalQuizQuestionBank){(0,_jquery.default)(SELECTORS_BANK_SEARCH).on("change",(e=>{const bankModId=(0,_jquery.default)(e.currentTarget).val();bankModId>0&&(ModalQuizQuestionBank.setBankModId(bankModId),ModalQuizQuestionBank.reloadBodyContent(window.location.search))}))}))})),this.getModal().on("click",SELECTORS_ANCHOR,(e=>{const anchorElement=(0,_jquery.default)(e.currentTarget);anchorElement.closest(SELECTORS_ADD_TO_QUIZ_CONTAINER).length?this.handleAddToQuizEvent(e,anchorElement):anchorElement.closest(SELECTORS_PREVIEW_CONTAINER).length||anchorElement.closest(SELECTORS_SORTERS).length||(anchorElement.closest("a["+SELECTORS_NEW_BANKMOD_ID+"]").length&&this.setBankModId(anchorElement.attr(SELECTORS_NEW_BANKMOD_ID)),e.preventDefault(),this.reloadBodyContent(anchorElement.prop("search")))})),this.getRoot().on(ModalEvents.bodyRendered,(()=>{FormChangeChecker.disableAllChecks()}))}}var obj,key,value;return _exports.default=ModalQuizQuestionBank,value="mod_quiz-quiz-question-bank",(key="TYPE")in(obj=ModalQuizQuestionBank)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,ModalQuizQuestionBank.registerModalType(),_exports.default}));

//# sourceMappingURL=modal_quiz_question_bank.min.js.map